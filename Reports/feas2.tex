\documentclass[12pt,letterpaper,twoside]{article}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{appendix}
\usepackage[figurewithin=section,tablewithin=section]{caption}
\usepackage[usenames,dvipsnames]{color}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{rotating}
%\usepackage{verbatim}
\usepackage[pdftex,bookmarksopen=false]{hyperref}
%\usepackage[pdftex]{hyperref}
\hypersetup{pdfauthor={John Sibert}}
\hypersetup{pdfsubject={Assessment Model of MHI YFT Stocks}}
\hypersetup{pdftitle={Assessment Models for Hawaiian Islands
Yellowfin Tuna Fishery}}
\hypersetup{pdfkeywords={yellowfin,state space, biomass transfer, model,Hawaii}}

\newcommand\doublespacing{\baselineskip=1.6\normalbaselineskip}
\newcommand\singlespacing{\baselineskip=1.0\normalbaselineskip}
\renewcommand\deg[1]{$^\circ$#1}
\newcommand\SD{SEAPODYM}
\newcommand\MFCL{MULTIFAN-CL}
\newcommand\ADMB{ADModel Builder}
\newcommand\SPC{Secretariat of the Pacific Community}
\newcommand\WCPO{Western Central Pacific Ocean}
\newcommand\SSAP{Skipjack Survey and Assessment Programme}
\newcommand\RTTP{Regional Tuna Tagging Programme}
\newcommand\PTTP{Pacific Tuna Tagging Programme}
\newcommand\FAD{fish aggregating device}
\newcommand\ADRM{advection-diffusion-reaction model}
\newcommand\help[1]{\color{Magenta}{\it #1 }\normalcolor}
\newcommand\widebar[1]{\overline{#1}}
\newcommand\EEZ{Exclusive Economic Zone}

\newcommand\None{{N_{1,1}}}
\newcommand\Ntwo{{N_{2,1}}}
\newcommand\Nsum{{N_{1,1}+N_{2,1}}}
\newcommand\peryr{yr$^{-1}$}
\newcommand\prevN[1]{{#1_{t-\Delta t}}}
\newcommand\nextN[1]{{#1_t}}
\newcommand\MSY{\tilde{Y}}
\newcommand\Fmsy{F_{\MSY}}

\title{Feasibility of developing a stock assessment model for Main
Hawaiian Islands Yellowfin Tuna Fishery\\
\vspace{2ex}
Part 2}

\author{
John Sibert\thanks{sibert@hawaii.edu}\\
Joint Institute of Marine and Atmospheric Research\\
University of Hawai'i at Manoa\\
Honolulu, HI  96822 U.S.A.\\[0.125in]
\date{\today}
}

\pagestyle{myheadings}
\markboth{John Sibert\hfil MHI Yellowfin Assessment Model
Feasibility---Part 2}
{MHI Yellowfin Assessment Model Feasibility---Part 2\hfil John Sibert}

\begin{document}
% amsmath package
\numberwithin{equation}{section}
\numberwithin{figure}{section}
\maketitle

%\doublespacing


\section{Executive Summary}
A previous evaluation of the feasibility of developing a
stock assessment model for the Main Hawaiian Islands yellowfin tuna
fishery concluded that such a model is feasible, but that estimation of
fishery management reference points is difficult (Sibert, 2015).
The ambiguity of this
conclusion is unsatisfying, and further research was undertaken to
develop more practical models. The 2015 model attempted to represent
the dynamics of two coupled tuna populations with immigration,
emigration, and fishing and required estimation of approximately 15
model parameters.
Alternative single population models with simplified model
structure
were examined. The simplified models are capable of
estimating critical reference points such as maximum sustainable
yield (MSY) and fishing mortality at MSY. Estimates of MSY range
between 1100mt and 1300mt per year (Table~\ref{tag:ests4}).
Estimated biomass trends between 1952 and 2012 
(Figure~\ref{fig:estbiomass}) differ in general level, but
qualitatively consistent across models. All models estimate a period of high
estimated high biomass between 1970 and 1990, 
including periods where the biomass exceeds the
equilibrium biomass or ``carrying capacity''. 
These models are
promising staring places to begin development of a full-featured stock
assessment model for the MHI yellowfin fishery.

\section{Models}
The basic model is  state-space implementation of the well known
Schaefer biomass dynamics model (Schaefer, 1954).
The principle model assumptions are:
\begin{enumerate}
\item The dynamics of the population of YFT in the MHI follows a
simple Schaefer model with MHI-specific growth parameters.
\item Fishing mortality is represented by a random walk (as in the
2015 two-population model).
\item The local dynamics are ``forced'' by assuming that the local
abundance is approximately proportional to some ``index'' population
such as the abundance of the larger Pacific population estimated by
another model.
\end{enumerate}

\section{Results}

\begin{figure}
\begin{center}
\includegraphics[width=\textwidth]{./graphics/biomass-array.pdf}
\caption{\label{fig:estbiomass}
}
\end{center}
\end{figure}

\begin{figure}
\begin{center}
\includegraphics[width=\textwidth]{./graphics/production-array.pdf}
\caption{\label{fig:estprod}
}
\end{center}
\end{figure}

\begin{table}
\caption{Model estimates from four different model configurations.
Model complexity, expressed in number of parameters estimated ($n$)
increases from left to right.
\label{tag:ests4}}
\begin{center}
\begin{tabular}{lrrrr}
\hline
Forcing & \multicolumn{2}{c}{None}&\multicolumn{2}{c}{MFCL 2}\\
\cline{2-3}\cline{4-5}
Parameterization&$\MSY\quad\Fmsy$&$B_1\quad d$&$\MSY\quad\Fmsy$&$B_1\quad d$\\
\hline
\hline
$n$ & 4 & 5 & 5 & 6\\
$-\log L$ & -237.238 & -237.221 & -247.175 & -242.816\\
$|G|_{max}$ & 0.0016409 & 2.11959e-06 & 3.51082e-05 & 29.6554\\
$B_1$ & --- & 5043.2 & --- & ---\\
$d$ & --- & 1.3675 & --- & ---\\
$\MSY$ & 1147.5 & 1083 & 1288.7 & ---\\
$\Fmsy$ & 0.82239 & 0.31408 & 0.1668 & ---\\
$r$ & 1.6448 & 0.62815 & 0.3336 & ---\\
$K$ & 2790.8 & 6896.6 & 15452 & ---\\
$\sigma_P$ & 0.37416 & 0.37042 & 0.2743 & ---\\
$\sigma_Y$ & 0.41693 & 0.41937 & 0.46924 & ---\\
$Q$ & --- & --- & 0.04321 & ---\\
\hline
\end{tabular}
\end{center}
\end{table}





\section{Discussion}

%The age-aggregated approach using a logistic model with emigration and
%immigration shows sufficient promise to continue model development.
%The general behavior of the model system (Figure~\ref{fig:simNN} and
%~\ref{fig:NNts}) appropriately describes a small persistent population
%interacting with a much larger one.
%The efficacy of the random walk
%representation of fishing mortality is particularly encouraging, and
%avoids debates about changes in catchability associated with
%changes in fishing efficiency.
%The proportion of local fish in the system is sensitive to model
%parameters and can effectively be constrained to be near the empirically
%determined value of 0.9. Coupling immigration to the output of
%some other model is relatively trivial to implement and is
%sufficiently flexible to use output from alternative models.
%
%Unfortunately, population dynamics parameters, with the possible
%exception of $q$, do not appear to be estimatable. Lack of
%sensitivity could be due to several causes: the model is completely
%ill-posed, the code is incorrect, there is no signal in data, or some
%combination of these. Inspection of catch trends
%(Figure~\ref{fig:annualTS}) does not reveal any obvious signs of stock
%depletion and recovery. Estimation of population dynamics parameters
%in a lightly exploited stock is a well-known problem in stock
%assessment.
%
%Figure~\ref{fig:NNphase} suggests that the model equations
%(\ref{eqn:coupledschaeferq}) have non-trivial equilibria for certain
%parameter values.
%The relationships between of the parameters $q$, $T^*_{21}$,
%and $\bar{p}$ are not clear.
%Estimation of fisheries reference point would be simpler if
%an analytic expression for the equilibrium point were available.
%Finite difference approximations of logistic population models are
%notoriously unstable under certain circumstances. An analytical
%solution of equation~\ref{eqn:coupledschaeferq} would be of great
%help.

\vspace{4ex}
%\clearpage
\noindent {\bf Acknowledgements.}
This work was funded by the Western Pacific Regional Fisheries
Managment Council. I thank the Council for its generous support and
Council Staff Paul Dalzell and Eric Kingma for encouraging me to
actually take on this challenging project and for their on-going
collaboration.
Thanks to Dr. David Fournier for suggesting the ``$B_1\;d$''
parameterization of the Schaefer model.
Thanks to Mr. David Itano for sharing insights into the small-boat
fisheries in Hawaii.
Thanks to Mr. Reginald Kokubun of the Hawaii Division of Aquatic
Resources for supplying catch report data from the HDAR commercial
fisheries data base.
Thanks to Mr. Keith Bigelow and Ms. Karen Sender of NOAA Pacific
Island Fisheries Science Center for supplying logbook reporting data and
weight-frequency data from the PIFSC data base.
Thanks also to Dr. John Hampton of the Secretariat of the Pacific
Community, Oceanic Fisheries Programme, for making available
MULTICAN-CL output files from the latest Western and Central Pacific
Fisheries Commission yellowfin tuna stock assessment, and to Mr. Nick
Davies for sharing R scripts and advice to decode the MFCL output files.

\section*{References}
{\parindent=0cm \small
\everypar={\hangindent=2em \hangafter=1}\par
%\doublespacing
%Adam, M. S., J. Sibert, D. Itano and K. Holland. 2003. Dynamics of
%bigeye (Thunnus obesus) and yellowfin tuna (T. albacares) in Hawaii's
%pelagic fishery: analysis of tagging data with a bulk transfer model
%incorporating size specific attrition. Fishery Bulletin 101(2):
%215-228.

Davies, N., S. Harley, J. Hampton, S. McKechnie. 2014. Stock
assessment of yellowfin tuna in the western and central pacific ocean.
WCPFC-SC10-2014/SA-WP-04.

Fournier, D. A., H.J. Skaug, J. Ancheta, J.Sibert, J. Ianelli, 
A. Magnusson, M. N. Maunder, A. Nielsen. 2012. AD Model Builder:
using automatic differentiation for forstatistical inference of highly
parameterized complex nonlinear models. Opti-mization Methods and
Software 27, 233–249.

Itano, D., K. Holland. 2000.  Movement and vulnerability of bigeye
(Thunnus obesus) and yellowfin tuna (Thunnus albacares) in relation to
FADs and natural aggregation points.Aquat. Living Resour. 13: 213-223.

Kleiber, P., J. Hampton, N. Davies, S. Hoyle, D. Fournier. 2014.
MULTIFAN-CL User’s Guide

Nielsen, A., C. Berg. 2014. Estimation of time-varying selectivity
in stock assessments using state-space models. Fisheries Research
158:96-101.

Murray, J. D. 1993. Mathematical biology. Second Edition.
Springer-Verlag. 767pp.

Quinn, T, R. Deriso. 1999. Quantitative fish dynamics. Oxford
University Press, New York.

Schaefer, M. B. 1954. Some aspects of the dynamics of populations
important to the management of the commercial marine fisheries. IATTC
Bull. 1(2):27-56.

Sibert, J. R. 2015. Feasibility of devloping a stock assessment
model for Main Hawaiian Islands Yellowfin Tuna Fishery.
119th Meeting of the Scientific and Statistical Committee.
Document 7.A.1(1)Rev 1.

Skaug, H., Fournier, D., 2006. Automatic approximation of the marginal
likelihood in non-Gaussian hierarchical models. Computational
Statistics \& Data Analysis 51, 699–709.

Wells, D., J. Rooker, D. Itano. 2012.  Nursery origin of yellowfin
tuna in the Hawaiian Islands. Mar. Ecol. Prog. Ser. 461:187-196. 
\par}

\clearpage


\section*{Appendix}
\appendix
\section{Model development}
\label{sec:models}
State-space models separate variability in the biological
processes in the system (transition model)
from errors in observing features of interest
in the system (observation model). 

{\bf Transition Model $T(\alpha_{t-1})$.}
The general form of the transition model is
\begin{equation}
\alpha_t=T(\alpha_{t-1}) + \eta_t
\end{equation}
where $\alpha_t$ is the state at time $t$ and 
the function $T$ embodies the dynamics mediating the
development of the state at time $t$ from the state at the previous
time with random process error, $\eta_t$.

Stock dynamics of follow the classic Schaefer form:
\begin{equation}
\label{eqn:ischaefer}
\frac{dN}{dt} = rN(1-\frac{N}{K}) - FN
\end{equation}
where $N$ is the biomass of YFT in the MHI, 
$r$ is the logistic growth rate per year,
$K$ is the asymptotic biomass, and
$F$ is the total fishing mortality per year in the MHI.

The state space transition equation for the single population model is
developed by solving \ref{eqn:ischaefer} analytically from one time to
the next (see Appendix \ref{sec:schaefer}).
\begin{equation}
\label{eqn:intschaeferA}
N_t = \frac{K(r-\bar{F}_t)}{\frac{K(r-\bar{F}_t)}{N_{t-\Delta t}}e^{-\Delta
t(r-\bar{F}_t)}-re^{-\Delta t(r-\bar{F}_t)} -r} \cdot e^{\eta_t};
\quad \eta_t\sim N(0,\sigma^2_N)
\end{equation}
where 
$\bar{F}_t$ is the total fishing mortality, i. e.,
$$
\bar{F}_t =\sum_{g=1}^n F_{g,t-\Delta t}.
$$
and $\eta_t \sim N(0,\sigma_N)$ is the process error expressing
variability in population dynamics.

Fishing mortality is treated as a random walk.
The logarithm of fishing mortality is assumed to
follow a random walk with normal increments, i.e.,
\begin{equation}
\label{eqn:Fwalk}
\log F_{g,t} = \log F_{g,t-1} + \xi_t;\quad \xi_t\sim
N(0,\sigma^2_F)
\end{equation}
where  $\sigma^2_F$ is the variance of the fishing
mortality random walk.

The indexed abundance model
assumes that the biomass of YFT in the MHI
is proportional to the biomass of an ``index'' population.
\begin{equation}
\log N_t - \log (Q\cdot I_t) + \omega_t;\quad \omega_t\sim N(0,\sigma^2_I)
\label{eqn:index}
\end{equation}
where
$I_t$ is the size of the index population at time $t$,
$Q$ is the estimated ratio of the MHI population size to the index
population,
and $\sigma^2_I$ is the variance of the difference between the
index and the predicted population size.

All process errors are assumed to have the same distribution
$N(0,\sigma^2_P)$; $\sigma_N$,$\sigma_F$, and $\sigma_I$ are assumed
to be equal and estimated as a global process error with variance
$\sigma^2_P$.

The logistic parameters $r$ and $K$ are notoriously difficult to estimate
accurately. Two different
alternative parameter substitutions were tested. In the first
alternative, MSY ($\MSY$) and fishing mortality at MSY ($\Fmsy$) were
estimated directly and substituted in in \ref{eqn:intschaeferA} as
$r=2F_{\MSY}$ and $K=\frac{4\MSY}{r}$.
In the second alternative, the initial population size $B_1$ and a
proportionality constant $d$ are estimated directly and substituted in
\ref{eqn:intschaeferA} as $K=d\cdot B_1$.


{\bf Observation Model, $O(\alpha)$.}
The general form of the observation model is
\begin{equation}
x_t = O(\alpha_t) + \varepsilon_t
\end{equation}
where the function $O$ describes the measurement process with
error $\varepsilon$ in observing the population.

Predicted catch, $\widehat{C}_{g,t}$, for each gear is the product of
estimated fishing mortality and the total biomass.
\begin{equation}
\widehat{C}_{g,t} = F_{g,t}\cdot\Bigl(\frac{N_{t-\Delta
t}+N_t}{2}\Bigr) \cdot e^{\varepsilon_t}
\label{eqn:obs1}
\end{equation}
where the total biomass is  the average
biomass over the time step (Quinn and Deriso, 1999), and
$\varepsilon_t$ is a ``zero-inflated'' normal likelihood given by
\begin{equation}
  \log \varepsilon_t = \left\{
    \begin{array}{r@{\;:\quad}l}
       C_{g,t} > 0 &
(1-p_0)\cdot\bigg(\log\frac{1}{\sqrt{2\pi\sigma^2_Y}}
          -\Bigl(\frac{\log
C_{g,t}-\log\widehat{C}_{g,t}}{\sigma_Y}\Bigr)^2\bigg)\\
       C_{g,t} = 0 & p_0 \cdot\log \frac{1}{\sqrt{2\pi\sigma^2_Y}}\\
    \end{array}
  \right.
\end{equation}
$p_0$ is the proportion of observed catch observations equal to zero.
This proportion may be estimated or fixed at a constant value. For
current analysis, it is fixed at $p_0 = 0.15738$ as computed from the data.
% line 186, file issams.cpp, prop_zero =  0.4918 0 0 0.098361 0.19672, tprop_zero = 0.15738



\begin{table}
\caption{Complete list of parameters for two alternative
parameterizations of the state-space single population Schaefer model.
\label{tab:allvars1}}
\begin{center}
\begin{tabular}{lll}
\hline
$\MSY\;\Fmsy$ & $B_1\;d$ & Definition\\
\hline
\hline
$\Fmsy$&  & Fishing mortality at maximum sustainable yield\\
$\MSY$ &  & Maximum sustainable yield\\
    & $r$ & Instantaneous growth rate\\
    & $B_1$ & Biomass at time of first observation\\
    &  $d $ & Constant of proportionality; $B_1=Q\cdot K$\\
$Q$ & $Q$ & Abundance index proportionality constant\\
$\sigma_P$ & $\sigma_P$ & Global process error SD; $\sigma_P=\sigma_N=\sigma_F=\sigma_Q$\\
$\sigma_Y$ & $\sigma_Y$ & Observation error SD \\
\hline
$p_0$ & $p_0$ & Proportion of zero catch observations;\\
      &        & fixed at $p_0 = 0.15738$\\
\hline
\end{tabular}
\end{center}
\end{table}

{\bf Estimation.} The model states, $N_t$ and $F_{gt}$, are assumed to be random
effects (Skaug and Fournier 2006). Model parameters are estimated by
maximizing the joint likelihood of the random
effects and the observations.
\begin{equation}
L(\theta,\alpha,x)=
\prod^m_{t=2}\big[\phi\big(\alpha_t-T(\alpha_{t-1}), \Sigma_\eta\big)\big]
\prod^m_{t=1}\big[\phi\big(x_t-O(\alpha_t), \Sigma_\varepsilon\big)\big]
\end{equation}
Here, $m$ is the number of time steps in the catch time series and
$\theta$ is a vector of model parameters.
The model is implemented in ADMB-RE (Fournier et al 2012).
The actual number of
parameters to be estimated depends on the model configuration,
specified by phase flags in the input file. 
All computer code, data files, and draft reports in support of this
analysis can be found at Github:
\url{https://github.com/johnrsibert/XSSA.git}.



\clearpage
\input{schaefer_section}

\end{document}
